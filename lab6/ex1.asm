;=================================================
; Name: Luk, Ryan
; Username: rluk001
; Lab: Lab 06
; Lab section: 022
; TA: Bryan Marsh
;=================================================

.orig x3000

LEA R0, PROMPT
PUTS

LD R6, SUB_INPUT
JSRR R6

ADD R1, R6, #1

LD R0, nLine
OUT

LD R6, SUB_PRINT
JSRR R6

HALT

PROMPT .STRINGZ "Input any positive number less than or equal to #32766 from the keyboard: "
SUB_INPUT .FILL x3200
SUB_PRINT .FILL x3400
nLine .FILL x0A

.orig x3200

ST R7, BACKUP_R7_3200

LD R1, ZEROMINUS
LD R4, FOUR
LD R6, ZERO
NOT R1, R1
ADD R1, R1, #1

INPUT_LOOP
	LD R3, NINE
	GETC
	OUT
	LD R5, newLine
	NOT R5, R5
	ADD R5, R5, #1
	ADD R5, R0, R5
	BRz INPUT_LOOP_END
	ADD R0, R0, R1
	ADD R6, R6, R0
	ADD R2, R6, #0
	FORT_LOOP
		ADD R6, R6, R2
		ADD R3, R3, #-1
		BRp FORT_LOOP	
	ADD R4, R4, #-1
	BRp INPUT_LOOP

GETC
OUT
	LD R5, newLine
	NOT R5, R5
	ADD R5, R5, #1
	ADD R5, R0, R5
	BRz INPUT_LOOP_END
	ADD R5, R0, R1
	ADD R6, R6, R5
	BR END_PRGM
INPUT_LOOP_END
	NOT R2, R2
	ADD R2, R2, #1
	LD R3, NINE
	FOR_MINUS
		ADD R6, R6, R2
		ADD R3, R3, #-1
		BRp FOR_MINUS
END_PRGM
LD R7, BACKUP_R7_3200

RET

FOUR .FILL #4
NINE .FILL #9
ZEROMINUS .FILL #48
BACKUP_R7_3200 .BLKW #1
ZERO .FILL #0
newLine .FILL x0A

.orig x3400

ST R1, BACKUP_R1_3400
ST R7, BACKUP_R7_3400

LD R3, COUNT
LD R2, SUBTRACT5
LD R5, ZEROPLUS

FOR_LOOP
	ADD R4, R1, #0
	ADD R1, R1, R2
	BRp INC5
	BR FOR_LOOP_END
	INC5
		ADD R3, R3, #1
		BR FOR_LOOP
FOR_LOOP_END

ADD R0, R3, R5
OUT
ADD R1, R4, #0

LD R3, COUNT
LD R2, SUBTRACT4
FOR_LOOP2
	ADD R4, R1, #0
	ADD R1, R1, R2
	BRp INC4
	BR FOR_LOOP2_END
	INC4
		ADD R3, R3, #1
		BR FOR_LOOP2
FOR_LOOP2_END
ADD R0, R3, R5
OUT
ADD R1, R4, #0

LD R3, COUNT
LD R2, SUBTRACT3
FOR_LOOP3
	ADD R4, R1, #0
	ADD R1, R1, R2
	BRp INC3
	BR FOR_LOOP3_END
	INC3
		ADD R3, R3, #1
		BR FOR_LOOP3
FOR_LOOP3_END

ADD R0, R3, R5
OUT
ADD R1, R4, #0

LD R3, COUNT
LD R2, SUBTRACT2
FOR_LOOP4
	ADD R4, R1, #0
	ADD R1, R1, R2
	BRp INC2
	BR FOR_LOOP4_END
	INC2
		ADD R3, R3, #1
		BR FOR_LOOP4
FOR_LOOP4_END

ADD R0, R3, R5
OUT
ADD R1, R4, #0

ADD R0, R1, R5
OUT

LD R1, BACKUP_R1_3400
LD R7, BACKUP_R7_3400

RET

BACKUP_R1_3400 .BLKW #1
BACKUP_R7_3400 .BLKW #1
SUBTRACT5 .FILL #-10000
SUBTRACT4 .FILL #-1000
SUBTRACT3 .FILL #-100
SUBTRACT2 .FILL #-10
COUNT .FILL #0
ZEROPLUS .FILL #48
.END
